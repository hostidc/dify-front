define("@baidu/video-controller/lib/videoController",["require","@searchfe/user-agent","versions-compare","@baidu/boxx","@baidu/splayer","@baidu/webb","@baidu/video-decoder-player"],function(e,t,i,n,o,a,r){"use strict";function s(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var h=s(t),f=s(i),v=s(n),l=s(o),d=s(a);function u(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function c(){return(c=Object.assign||function(e){
for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e}).apply(this,arguments)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function y(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function m(){var e=!1,t=!1,i=!1,n=!1,o=0,a=0,r=0;return window.page&&window.page.comm&&window.page.comm.sampleval&&(
e="1"===window.page.comm.sampleval.VIDEO_NEW_PLAY_RULES,t="1"===window.page.comm.sampleval.VIDEO_A2C_TRANSITION,i="1"===window.page.comm.sampleval.VIDEO_A2C_TRANSITION_ADD_PAUSE,n="1"===window.page.comm.sampleval.VIDEO_SCROLL_PLAY_RULES,o=+window.page.comm.sampleval.VID_PLAY_RECORDED_NIDS||0,a=+window.page.comm.sampleval.VIDEO_DRAGGING_OPTIMIZE_REVERSE||0,r=+window.page.comm.sampleval.VIDEO_AUTOPLAY_DELAY_TIME||0),{VIDEO_NEW_PLAY_RULES:e,VIDEO_A2C_TRANSITION:t,VIDEO_A2C_TRANSITION_ADD_PAUSE:i,
VIDEO_SCROLL_PLAY_RULES:n,VID_PLAY_RECORDED_NIDS:o,VIDEO_DRAGGING_OPTIMIZE_REVERSE:a,VIDEO_AUTOPLAY_DELAY_TIME:r}}var I=m().VIDEO_NEW_PLAY_RULES;function w(e,t,i,n,o){if(I){var a=t[i],r=t[n];if(a!==r)return r<a}var s=e[i].options.container,l=e[n].options.container,d=s.getBoundingClientRect(),u=l.getBoundingClientRect();if(d.top!==u.top)return d.top<u.top;if(I){if(o&&o===i)return!0;if(o&&o===n)return!1}return d.left<u.left}var P=h.default.isBaiduboxOrBdapp()||h.default.isGoogleChrome(
)||h.default.isSafariBrowser()||h.default.isBDBoxEngine()||h.default.isVivoBrowser()&&0<=f.default(h.default.vivoBrowserVersion().join("."),"20.6.0.0")||/ChatSearch/.test(window.navigator.userAgent);function g(){var e=/\/s$/.test(window.location.pathname);return window.hasBoxLgFloor?!window.ssIsPaused&&!window.ss_webview_is_in_background&&0===window.boxLgFloorStatus:!(h.default.isBaiduBox()&&!h.default.isBaiduBoxJisu()&&e&&(window.ssIsPaused||window.ss_webview_is_in_background))}function V(e){
return null==e.closest?void 0:e.closest("[srcid]")}function b(){return document.documentElement.scrollTop||window.pageYOffset||document.body.scrollTop}function E(){try{var e=window.page&&window.page.cookie&&window.page.cookie("player_params");if(e){var t=e.indexOf("ds_stc@");if(-1!==t)return e.slice(t+7,t+11)}}catch(e){}return 0}var T=h.default.isBaiduBox()&&!h.default.isBaiduBoxLite()&&!h.default.isBaiduBoxJisu(),S=h.default.isVivoBrowser(
)&&!!window&&!!window.vivoEx&&"function"==typeof window.vivoEx.getVideoAutoPlayStrategy,A="",_=-1;function O(e){"wifi"!==A&&"unknown"!==A&&e&&null!=v.default&&v.default.canIUse("search.showMobileNetPushVideoSettingPageToast")&&v.default.search.showMobileNetPushVideoSettingPageToast(e)}function x(){return Promise.all([(n="unknown",new Promise(function(i){null!=v.default&&v.default.canIUse("device.getNetworkType")?v.default.device.getNetworkType({success:function(e){var t;A=null!=e&&null!=(
t=e.data)&&t.networkType?e.data.networkType:n,i(A)},fail:function(){i(A=n)}}):i(A=n)})),new Promise(function(i){null!=v.default&&v.default.canIUse("search.getWifiVideoAutoplaySwitchType")?v.default.search.getWifiVideoAutoplaySwitchType({success:function(e){var t;i(!(null==e||null==(t=e.data)||!t.value)&&1==+e.data.value)},fail:function(){i(!0)}}):i(!0)}),new Promise(function(i){null!=v.default&&v.default.canIUse("search.getMobileNetVideoAutoplaySwitchType"
)?v.default.search.getMobileNetVideoAutoplaySwitchType({success:function(e){var t;i(!(null==e||null==(t=e.data)||!t.value)&&1==+e.data.value)},fail:function(){i(!0)}}):i(!0)}),new Promise(function(e){if(S){var t,i,n="wifi"===(null==(t=navigator)||null==(i=t.connection)?void 0:i.type);switch(window.vivoEx.getVideoAutoPlayStrategy()){case 0:e(!0);break;case 1:e(n);break;case 2:e(!1);break;default:e(!0)}}else e(!0)})]).then(function(e){var t=e[0],i=e[1],n=e[2],o=e[3]
;return S?o:_="wifi"===t?i?1:0:n?1:0});var n}var D,L,N,R,B=((R=le.prototype).on=function(e,t,i){return void 0===i&&(i=!1),this.es[e]||(this.es[e]=[]),this.es[e].push({cb:t,once:i}),this},R.once=function(e,t){return this.on(e,t,!0),this},R.emit=function(e){for(var t=this.es[e]||[],i=t.length,n=arguments.length,o=new Array(1<n?n-1:0),a=1;a<n;a++)o[a-1]=arguments[a];for(var r=0;r<i;r++){var s=t[r],l=s.cb,d=s.once;l.apply(this,o),d&&(t.splice(r,1),r--,i--)}return this},R.off=function(e,t){if(
void 0===e)this.es={};else if(void 0===t)delete this.es[e];else for(var i=this.es[e]||[],n=i.length,o=0;o<n;o++)i[o].cb===t&&(i.splice(o,1),o--,n--);return this},le),F=["autoplay","buffered","crossOrigin","currentSrc","currentTime","cumulationPlayDuration","defaultMuted","duration","ended","error","loop","muted","networkState","paused","playbackRate","played","playingDuration","preload","readyState","seekable","seeking","src","volume","fullScreen","needReadLocalProgress","ignore4gToast",
"seekSeconds","videoGravity","syncPlayerCacheProgress","isIgnoreDeviceOrientation"],k=["playBtnClicked","voiceBtnClicked","rateBtnClicked","barrageSwitchChanged","pointTouchStart","pointTouchMove","pointTouchEnd","fullScreen","click","destroy","successPlay","touchstart","init","ready","reset","prepare","play","pause","ended","error","closed","canplay","timeupdate","volumechange","mutedchange","loadingchange","cachetimechange","cacheloadfinished","ratechange","startnextloop","enterfullscreen",
"exitfullscreen","netchange","controlhiddenchange","enterpictureinpicture","suspenseclick","leavepictureinpicture","closesuspense","enterpip","closepip","pipclick","pipfail","abort","canplaythrough","durationchange","emptied","loadeddata","loadstart","playing","progress","seeked","seeking","stalled","suspend","waiting","playerPlaceHolerViewDealloc","playerReuse","playerDidReused"],C=["destory","ended","play","playing","pause"],U=["customPlugins","plugins","mimetype","type","decoderSwitch"],Y=[
"autoplay","preview"],M=m(),j=M.VIDEO_NEW_PLAY_RULES,W=M.VID_PLAY_RECORDED_NIDS,G="search_ala_playRecorded",H=(D={pid:"1_5",lid:(new Date).getTime(),pf_comm:{sample:.01},count_comm:{sample:.001}},-1!==document.cookie.indexOf("webbtest=1")&&["pf_comm","count_comm"].forEach(function(e){D[e].sample=1}),new d.default(D)),q=function(n){var e,t;function i(e,t){var i;return u(y(i=n.call(this)||this),"player",null),u(y(i),"status",""),u(y(i),"type","none"),u(y(i),"videoId",0),u(y(i),"options",{}),u(y(i)
,"hasPlayed",!1),u(y(i),"draggingOptimizeReverse",0),u(y(i),"defaultRatio",j?.3:.7),u(y(i),"lastTime",0),u(y(i),"prepareStartTime",0),u(y(i),"prepareEndTime",0),u(y(i),"isFirstPlay",!0),u(y(i),"videoUpdate",!1),u(y(i),"showRatio",0),u(y(i),"findInstanceDuration",-1),u(y(i),"perfInfo",{}),u(y(i),"playerIsReady",!1),u(y(i),"needLoop",!0),u(y(i),"loopStartTime",0),u(y(i),"cumulationPlayDurationLocal",0),u(y(i),"lastVideoSrc",""),t.container?(i.videoId=e,i.type=t.playType||"none",i.initData(t),
i.addObserver(),i.sendCountWebbLog(),i):y(i)}t=n,(e=i).prototype=Object.create(t.prototype),p(e.prototype.constructor=e,t);var o=i.prototype;return o.sendCountWebbLog=function(){var e,t,i=function e(t){var i=t.parentElement;if(!i||"results"===i.id||"BODY"===i.nodeName)return"";var n=i.getAttribute("tpl");if(n){var o="";return"lego_tpl"===n&&(o=i.getAttribute("legoid")),n+(o?"_"+o:"")}return e(i)}(this.options.container),n=h.default.isBaiduBox()?"baidubox":"other",l=V(this.options.container),
o=l&&function(e){var t=l||document.body,i=null==e.closest?void 0:e.closest("a");if(i&&i.getAttribute("href"))return i;for(var n=null,o=e;o&&o!==t;){var a=o.hasAttribute("rl-node"),r=o.getAttribute("rl-type"),s=o.getAttribute("rl-link-href");if("stop"===r||"button"===r)break;if(a&&s){n=o;break}o=o.parentNode}return n}(this.options.container),a=(null==o?void 0:o.getAttribute("data-click"))||(null==o?void 0:o.getAttribute("rl-link-data-click")),r=null;try{r=a&&JSON.parse(a)}catch(e){r={}}var s=-1<[
"video_na","video_jsy","xsp_na","xsp_jsy"].indexOf(null==(e=r)||null==(t=e.clk_info)?void 0:t.jumpType);i&&H.send("count_comm",{count:1},{tplName:i,browser:n,isVideoLink:s,playType:this.type},null,{group:"videoControlCount"})},o.canAutoPlay=function(e){return!this.isForbidPlayType()&&!!(this.isPreviewType()||this.isAutoplayType()&&!this.hasPlayed)&&(!e||e.contains(this.options.container))},o.addObserver=function(){this.options.container.setAttribute("data-video-id",String(this.videoId)),
ge.intersectObserver.observe(this.options.container)},o.isAutoplayType=function(){return"autoplay"===this.type},o.isPreviewType=function(){return"preview"===this.type},o.isForbidPlayType=function(){var e=this.options.allBrowserCanPlay||P||this.options.decoderSwitch&&this.options.isWasmPlayerSupport;return!this.type||"none"===this.type||!e},o.setLoopStartTime=function(e){this.loopStartTime=e||0},o.destroy=function(e){e&&(this.hasPlayed=!1,this.videoUpdate=!1),this.player&&(this.isPreviewType()||(
this.player.duration-this.player.currentTime<1?this.lastTime=0:this.lastTime=this.player.currentTime||0),void 0!==this.player.muted&&(this.options.muted=this.player.muted),this.player.destroy(),this.player=null,this.playerIsReady=!1)},o.switchVideo=function(e){if(this.options=Object.assign(this.options,e),this.lastTime=0,this.setLoopStartTime(this.options.currentTime),e.mpd||(this.options.mpd=""),e.clarityUrl||(this.options.clarityUrl=""),this.player){this.videoUpdate=!0,this.hasPlayed=!1,
this.emit("beforePlay");var t=this.filterOptions(),i=t.videoData,n=t.playerOption;this.player.currentTime=i.currentTime||0,this.player.resetVideo(i,n)}else this.destroy(),this.play()},o.videoAutoplay=function(){var t=this;g()&&(-1===_?x().then(function(e){t.emit("mobileNetAutoplaySwitch",e),(0<e||t.isPreviewType())&&(t.play(),O(t.options.naNetToastParams))}):(this.emit("mobileNetAutoplaySwitch",_),(0<_||this.isPreviewType())&&(this.play(),O(this.options.naNetToastParams))))},o.play=function(){
var e;if(!ge.hasLeaveState)if(this.hasPlayed=!1,(null==(e=ge.currentVideoInstance)?void 0:e.videoId)!==this.videoId&&ge.prerenderProcessed)ge.priorityPlay(this.videoId);else{this.emit("beforePlay");var t=!1;if(this.player&&(t="SAMELAYER_PLAYER"===this.player.type?this.player:this.player.video),!t||"destroy"===this.status)return this.initPlayer(),this.player;this.player.play()}},o.pause=function(){this.player&&this.player.pause()},o.load=function(){this.player&&this.player.load()},
o.enterFullscreen=function(){this.player&&this.player.enterFullscreen()},o.exitFullscreen=function(){this.player&&this.player.enterFullscreen()},o.enterSuspense=function(){this.player&&this.player.enterSuspense()},o.exitSuspense=function(){this.player&&this.player.exitSuspense()},o.registryPlugin=function(){this.player&&this.player.enterFullscreen()},o.registryPlugins=function(){this.player&&this.player.enterFullscreen()},o.setOption=function(e,t){this.options[e]=t,"currentTime"===e&&(
this.lastTime=t)},o.setLoop=function(){var e=ge.inviewVideoIds.filter(function(e){return ge.allInstance[e].canAutoPlay()});if(this.player){var t=this.isPreviewType()&&e[0]===this.videoId&&1===e.length||this.player.loop;this.player.loop=!!t}},o.updateNeedLoop=function(){var e;if(this.player){var t=ge.findNextVideoId();this.needLoop=(null==(e=ge.currentVideoInstance)?void 0:e.videoId)===this.videoId&&0===t}},o.initPlayer=function(){var t=this,e=this.filterOptions(),i=e.videoData,n=e.playerOption
;i.playType="autoplay",i.autoplay=!0,this.player=new l.default(i,n),this.proxyEvent(),this.setProps(),this.player.on("successPlay",function(){return t.isFirstPlay=!1}),this.player.on("playing",function(){return t.player.playbackRate=1}),ge.tryRecoverPreparePlayer&&this.player.one("ready",function(){var e;ge.tryRecoverPreparePlayer=!1,(null==(e=ge.currentVideoInstance)?void 0:e.videoId)===t.videoId&&t.play()})},o.filterOptions=function(){var t=Object.assign({},this.options);h.default.isBaiduBox(
)||h.default.isUC()||h.default.isTomas()||(t.muted=!0),t.videoContainer&&(t.container=t.videoContainer),this.lastTime&&(t.currentTime=this.lastTime||0),["playType","intersectionOption","naNetToastParams"].forEach(function(e){delete t[e]}),this.showRatio=ge.allVideoInterViewRatio[this.videoId],this.lastVideoSrc&&this.lastVideoSrc!==t.src&&(this.cumulationPlayDurationLocal=0),this.lastVideoSrc=t.src;var i={extra:c({},t.extra,{lastTime:this.lastTime,isFirstPlay:this.isFirstPlay,pfLog:{},network:A,
showRatio:this.showRatio,perfInfo:this.perfInfo,cumulationPlayDuration:this.cumulationPlayDurationLocal})};return 0<this.findInstanceDuration&&(i.extra.pfLog.findInstanceDuration=this.findInstanceDuration),0<this.prepareStartTime&&(i.extra.pfLog.instancePrepareDuration=Date.now()-this.prepareStartTime),this.findInstanceDuration=-1,this.prepareStartTime=-1,U.forEach(function(e){i[e]=t[e],delete t[e]}),{videoData:t,playerOption:i}},o.playEnd=function(){var e=this
;document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||this.player.loop||(this.hasPlayed=!0,this.videoUpdate=!1,setTimeout(function(){if(!e.videoUpdate){if(e.updateNeedLoop(),e.needLoop)return e.play(),void(e.player.currentTime=e.loopStartTime||0);e.lastTime=0,e.options.currentTime=0,e.options.holdForPlayend||e.destroy(),ge.findNextPlayVideo(e.videoId)}}))},o.setProps=function(){var e=this;F.forEach(function(t){
Object.defineProperty(e,t,{enumerable:!0,configurable:!0,get:function(){return this.player&&this.player[t]},set:function(e){this.player&&(this.player[t]=e,"currentTime"===t&&(this.lastTime=e))}})})},o.initData=function(e){var t=e.intersectionOption,i=e.naNetToastParams,n=e.type||(this.isPreviewType()&&(!h.default.isBaiduBox()||h.default.isBaiduBox()&&h.default.isAndroid()&&f.default(h.default.baiduBoxVersion(),"13.27")<0)?"NATIVE_PLAYER":"SAMELAYER_PLAYER");this.options=c({},e,{
autoplay:"none"!==this.type,t7PlayerType:this.isPreviewType()?"inline":e.t7PlayerType||"",type:n,intersectionOption:{ratio:"number"==typeof(null==t?void 0:t.ratio)?t.ratio:this.defaultRatio},naNetToastParams:Object.assign({pageId:"search_result_page",bussiness:"sfe_default_video"},i),playType:this.type}),this.setLoopStartTime(this.options.currentTime),1===this.options.intersectionOption.ratio&&(this.options.intersectionOption.ratio=.99)},o.rebuildPlayer=function(){var e;(null==(
e=ge.currentVideoInstance)?void 0:e.videoId)===this.videoId&&(this.destroy(),this.videoAutoplay())},o.getPlayRecorded=function(){var e=[];try{var t;e=JSON.parse((null==(t=window.sessionStorage)?void 0:t.getItem(G))||"[]")}catch(e){}return e},o.setPlayRecorded=function(e){if(e&&window.sessionStorage){var t=this.getPlayRecorded();-1===t.indexOf(e)&&(t.push(e),10<t.length&&(t=t.slice(-10)),window.sessionStorage.setItem(G,JSON.stringify(t)))}},o.proxyEvent=function(){var a=this;k.forEach(function(t
){var e,i,n,o;e={selector:a.player,eventName:t,fn:function(e){-1<C.indexOf(t)&&(a.status=t),"ended"===t&&a.playEnd(),"timeupdate"===t&&(a.cumulationPlayDurationLocal=a.player.cumulationPlayDuration),"playerPlaceHolerViewDealloc"===t&&a.rebuildPlayer(),"successPlay"===t&&(ge.clearPriority(),a.lastTime&&!a.isPreviewType()||(W&&a.setPlayRecorded(a.options.vid||a.options.nid),a.emit("videoStart")),a.lastTime&&(a.player.currentTime=a.lastTime),a.videoUpdate&&(
a.player.currentTime=a.options.currentTime||0)),"enterpictureinpicture"===t&&ge.setControllerEnable(!1),"leavepictureinpicture"===t&&ge.setControllerEnable(!0),a.emit(t,e)},context:a},i=e.eventName,n=e.fn,o=e.context,e.selector.off(i).on(i,function(e){n.apply(o,[e])})})},i}(B),Q=m(),J=Q.VIDEO_NEW_PLAY_RULES,z=Q.VIDEO_A2C_TRANSITION,K=Q.VIDEO_A2C_TRANSITION_ADD_PAUSE,Z=Q.VIDEO_SCROLL_PLAY_RULES,X=document.hidden,$=null,ee=0,te=0,ie=0,ne=0,oe=h.default.isBaiduBox()&&!h.default.isBaiduBoxLite(
)&&!h.default.isBaiduBoxJisu(),ae=!1,re=+E(),se=!!(re&&re<.45);function le(){u(this,"es",{})}function de(){var u=ge.currentVideoInstance,e=ge.ttsForbidAutoplay;(X||null!=u&&u.paused)&&g()&&(X=!1,ge.hasLeaveState=!1,e||Promise.all([x(),new Promise(function(i){var n={ttsStatus:"idle"};null!=v.default&&v.default.canIUse("media.tts.streamStatus")?v.default.media.tts.streamStatus({category:"",id:"",success:function(e){var t;n.ttsStatus=null==(t=e.data)?void 0:t.ttsStatus,i(n)},fail:function(){i(n)}}
):i(n)})]).then(function(e){var n,o,a,r=e[0],t=e[1];if(u){var i=u.options,s=i.vid,l=i.pageUrl;"playing"===t.ttsStatus&&(u.muted=!0);var d=z&&oe&&0<=f.default(h.default.baiduBoxVersion(),"13.20");(n=s,o=l,void 0===(a=d&&ae)&&(a=!1),new Promise(function(t,i){null!=v.default&&v.default.canIUse("media.video.readVideoHistoryPlayerInfo")&&!a&&n&&o?v.default.media.video.readVideoHistoryPlayerInfo({vid:n,pageUrl:o,success:function(e){try{t({vid:e.data.vid,progress:String(e.data.progress)})}catch(e){i(e)
}}}):i()})).then(function(e){setTimeout(function(){X||(u&&r&&u.videoAutoplay(),u&&s===e.vid&&(u.currentTime=e.progress))},500)}).catch(function(){if(u.isAutoplayType()){var e=h.default.isAndroid()&&oe&&0<=f.default(h.default.baiduBoxVersion(),"13.20");if(z&&e)return;u&&r&&u.videoAutoplay()}else if(h.default.isBaiduBox()){var t=-1;if(u&&u.isPreviewType()){var i=ge.inviewVideoIds.indexOf(u.videoId)-1;0<=i&&(t=ge.inviewVideoIds[i])}setTimeout(function(){X||(u&&u.play(),ge.findNextPlayVideo(t))},300
)}else setTimeout(function(){if(u&&u.isPreviewType()&&u.paused){if(X)return;u.play()}},500)}).finally(function(){ae=!1})}else ge.findNextPlayVideo()}))}function ue(){if(!X){X=!0,ge.hasLeaved=!0,ge.hasLeaveState=!0;var e,t=ge.currentVideoInstance;if(t){var i=t.options,n=i.vid,o=i.pageUrl,a=i.container;t.isPreviewType()&&(ge.nextPlayVideoId=ge.nextPlayVideoId||t.videoId),n&&o&&(u=n,c=o,p=t.currentTime||0,u&&c&&null!=v.default&&v.default.canIUse("media.video.saveVideoHistoryPlayerInfo"
)&&null!=v.default&&v.default.canIUse("media.video.seekPlayer")&&(v.default.media.video.saveVideoHistoryPlayerInfo({vid:u,pageUrl:c,progress:String(Math.ceil(p)||0)}),(!T||f.default(h.default.baiduBoxVersion(),"13.49.5")<0)&&v.default.media.video.seekPlayer({vid:u,pageUrl:c,seek:String(Math.ceil(p)||0)})));var r=oe&&0<=f.default(h.default.baiduBoxVersion(),"13.18");if(!K&&z&&r){var s=V(a),l=(null==s?void 0:s.getAttribute("data-video-link-id"))||"",d=null==s?void 0:s.getAttribute(
"data-link-jumping");e=document.body.querySelectorAll("[data-link-jumping], [data-video-link-id]"),Array.from(e).forEach(function(e){e.removeAttribute("data-link-jumping"),e.removeAttribute("data-video-link-id")}),(ae=!(!d||!l)&&l===n)||t.pause()}else t.pause()}}var u,c,p}function ce(){window.ssIsPaused||window.ss_webview_is_in_background?ue():de()}var pe=m(),he=pe.VIDEO_NEW_PLAY_RULES,fe=pe.VIDEO_DRAGGING_OPTIMIZE_REVERSE,ve=pe.VIDEO_AUTOPLAY_DELAY_TIME,ye="[class^=h5-samelayer-cid-]";x()
;var me,Ie=!1,we=/\/s$/.test(window.location.pathname)&&!(null!=(L=window.page)&&null!=(N=L.comm)&&N.chatSearch);(me||(me={})).INSTANCECHANGE="INSTANCECHANGE";var Pe,ge=((Pe=Ve.prototype).setControllerEnable=function(e){void 0===e&&(e=!0),this.controllerEnable=e},Pe.initFpAutoPlay=function(){var o=this,e=window.screen,a=e.width,r=e.height,s=b(),l=Number.MAX_VALUE,d=Number.MAX_VALUE;Y.forEach(function(e){Array.prototype.forEach.call(document.querySelectorAll('[data-video-play-type="'+e+'"]'),
function(e){var t=e.getBoundingClientRect(),i=t.top,n=t.left;i<l&&n<d&&s<i&&i<=s+r&&n<=a&&(o.fpAutoPlayEl=e,l=i,d=n)})}),this.fpAutoPlayEl&&setTimeout(function(){o.fpAutoPlayEl&&(o.fpAutoPlayEl=null,o.newFindNextVideo())},2500)},Pe.updateFpAutoPlay=function(e){if(this.fpAutoPlayEl&&e){for(var t=e;t&&!(-1<Y.indexOf(t.getAttribute("data-video-play-type")||""));)t=t.parentElement;t&&this.fpAutoPlayEl===t&&(this.fpAutoPlayEl=null)}},Pe.delayAutoplay=function(e){var t=this;void 0===e&&(e=0),e&&(
this.inForbidAutoplayTime=!0,setTimeout(function(){t.inForbidAutoplayTime=!1,t.newFindNextVideo()},e))},Pe.resetIntersectObserver=function(e){void 0===e&&(e={});var t=this.intersectObserver;for(var i in this.intersectObserver=this.createIntersectionObserver(e),this.allInstance){var n=this.allInstance[i].options.container;t.unobserve(n),this.intersectObserver.observe(n)}},Pe.createIntersectionObserver=function(e){var t=this;void 0===e&&(e={});var i="0px 0px -"+(window.BdboxBottomBarHeight||"0"
)+"px 0px";return new IntersectionObserver(function(e){t.controllerEnable&&(t.setInviewList(e),t.findNextPlayVideo())},c({threshold:he?[0,.1,.2,.3,.4,.5,.6,.7,.8,.9,.99,1]:[0,.5,.7,.9,.99,1],rootMargin:i},e))},Pe.createInstance=function(e){!Ie&&this.controllerEnable&&(Ie=!0,function(){if(window.hasBoxLgFloor&&window.addEventListener("boxLgFloorChanged",function(e){var t=e.status,i=ge.currentVideoInstance;0!==t||X?i&&i.pause():i?i.videoAutoplay():ge.findNextPlayVideo()}),window.addEventListener(
"bbabeepagewillactive",function(){de()}),window.addEventListener("bbabeepagewillinactive",function(){ue()}),document.addEventListener("visibilitychange",function(){document.hidden?ue():de()}),window.addEventListener("pageshow",function(){de()}),window.addEventListener("pagehide",function(){ue()}),window.addEventListener("beforeunload",function(){ue()}),window.addEventListener("unload",function(){ue()}),oe&&f.default(h.default.baiduBoxVersion(),"13.24")<0){var e=document.querySelector(
"[id^=vid_js_bridge]");e&&(e.contentWindow?e.contentWindow.addEventListener("message",ce):e.addEventListener("load",function(){e.contentWindow.addEventListener("message",ce)}))}window.addEventListener("message",function(e){var t=e.data;null!=t&&t&&"object"==typeof t&&"type"in t&&"action"in t&&"mediaAction"===t.type&&"resumeMedia"===t.action&&de()});var a=!J;window.addEventListener("touchstart",function(){a=!(h.default.isSearchCraft()||J&&!h.default.isBaiduBox()&&!h.default.isBaiduHonorBrowser())
,ie=Date.now(),ne=window.scrollY}),window.addEventListener("scroll",function(){if(ge.hasScrolled||(ge.hasScrolled=!0),!se&&Z&&J&&h.default.isIOS()&&h.default.isBaiduBox()&&100<=Date.now()-ie){var e=1e3*Math.abs(window.scrollY-ne)/(Date.now()-ie);ie=Date.now(),ne=window.scrollY,e<200&&(a=!1,ge.setScrolling(!1))}if($||(a&&ge.setScrolling(!0),J&&(ee=te=window.scrollY,ge.pageScrollStart())),J){var t=window.scrollY,i=te-ee,n=t-te;0!=i&&0!=n&&0<i!=0<n&&(ee=t);var o=(te=t)-ee;42<o?ge.pageScrollUp(
):o<-42&&ge.pageScrollDown()}clearTimeout($),$=setTimeout(function(){a&&ge.setScrolling(!1),$=null},a?200:50)}),void 0!==window.BdboxBottomBarHeight&&document.addEventListener("onChangeBottomBar",function(e){var t;ge.resetIntersectObserver({rootMargin:"0px 0px -"+((null==e||null==(t=e.detail)?void 0:t.offset)||0)+"px 0px"})})}()),e.isWasmPlayerSupport=this.isWasmPlayerSupport,e.initPlayer=+new Date;var t=e||{},i=t.playType,n=t.container;-1<Y.indexOf(i||"")&&this.updateFpAutoPlay(n);var o=new q(
++this.videoId,e);if(o.draggingOptimizeReverse=fe,o.videoId)return this.allInstance[this.videoId]=o,this.addInviewKey(o.videoId),o},Pe.setScrolling=function(e){(this.isScroll=e)||this.findNextPlayVideo()},Pe.resetParentDom=function(){var i=this;this.isScroll||!this.focusedParentDom||this.inviewVideoIds.some(function(e){var t;return null==(t=i.focusedParentDom)?void 0:t.contains(i.allInstance[e].options.container)})||this.clearPriority()},Pe.raisePriority=function(e){this.focusedParentDom=e,
this.findNextVideoId()<=0&&(this.focusedParentDom=null),this.findNextPlayVideo()},Pe.clearPriority=function(){this.focusedParentDom=null},Pe.priorityPlay=function(e){var t=this;this.prerenderProcessed&&(this.currentVideoInstance&&this.currentVideoInstance.videoId===e||(this.clearPriority(),this.currentVideoInstance&&this.currentVideoInstance.destroy(),this.setCurrentVideoInstance(this.allInstance[e]),setTimeout(function(){t.currentVideoInstance&&t.currentVideoInstance.play()})))},
Pe.updateToNextVideoInstance=function(){var e,t=this.findNextVideoId(null==(e=this.currentVideoInstance)?void 0:e.videoId);-1<t&&(this.nextPlayVideoId=t)},Pe.newFindNextVideo=function(e){var t=this;if(!this.inForbidAutoplayTime&&!(this.ttsForbidAutoplay||this.fpAutoPlayEl||this.hasLeaveState||this.isScroll)){this.resetParentDom();var i=this.findNextVideoId(e);if(i<=0)for(var n in this.allInstance)this.allInstance[n].startFindInstanceTime=-1;else{if(this.currentVideoInstance){if(
this.currentVideoInstance.videoId===i){for(var o in this.allInstance)this.allInstance[o].startFindInstanceTime=-1;return}this.currentVideoInstance&&this.currentVideoInstance.destroy()}for(var a in this.setCurrentVideoInstance(this.allInstance[i]),this.currentVideoInstance.prepareStartTime=Date.now(),0<this.currentVideoInstance.startFindInstanceTime&&(this.currentVideoInstance.findInstanceDuration=Date.now()-this.currentVideoInstance.startFindInstanceTime),
this.currentVideoInstance.perfInfo=this.collectPerf(this.currentVideoInstance),this.isFirstVideo&&(this.isFirstVideo=!1),this.allInstance)this.allInstance[a].startFindInstanceTime=-1;this.processPrerenderVideo(),setTimeout(function(){t.currentVideoInstance&&t.currentVideoInstance.videoAutoplay()})}}},Pe.registerEvent=function(e,t){if(t){var i=this.events.has(e),n=this.events.get(e)||new Set;n.add(t),i||this.events.set(e,n)}},Pe.dispatch=function(e,t){var i=this.events.get(e);i&&Promise.resolve(
).then(function(){i.forEach(function(e){e(t)})})},Pe.setCurrentVideoInstance=function(e){this.currentVideoInstance=e,this.dispatch(me.INSTANCECHANGE,e)},Pe.processPrerenderVideo=function(){var o=this;this.prerenderProcessed||(Object.keys(this.allInstance).forEach(function(e){var t,i=o.allInstance[e],n=null==i||null==(t=i.options)?void 0:t.container;if(n&&(n.querySelector(ye)||n.querySelector('video[data-pre-name="video-prepare-video"]')))if(h.default.isIOS()&&n.querySelector(ye)&&(
o.tryRecoverPreparePlayer=!0),i!==o.currentVideoInstance)try{i.videoAutoplay(),i.emit("prerenderDestroy"),i.destroy()}catch(e){}else i.videoAutoplay()}),this.prerenderProcessed=!0)},Pe.collectPerf=function(e){var t,i,n,o,a=null==e||null==(t=e.options)||null==(i=t.container)?void 0:i.querySelector(ye),r=this.hasScrolled||0<b(),s=(null==e||null==(n=e.options)?void 0:n.container)&&V(e.options.container),l=/^fold_/.test(s&&s.getAttribute("consume-type")||""),d=!(!s||!s.getAttribute("order")
)&&+s.getAttribute("order")<=4,u=[];if(!this.hasFsv&&!r&&this.isFirstVideo&&!this.hasLeaved&&!a&&!l&&d&&null!=(o=window.performance)&&o.timing){var c=window.performance.timing;u=[{key:"startSearch",value:c.navigationStart},{key:"firstPackage",value:c.responseStart},{key:"upScreen",value:c.domInteractive}]}var p=+new Date;return{page:u,player:[{key:"prepare",value:0<e.startFindInstanceTime?e.startFindInstanceTime:p},{key:"queryInstance",value:p}]}},Pe.findNextVideoId=function(e){if(
this.nextPlayVideoId){var t=this.nextPlayVideoId;return this.nextPlayVideoId=0,t}for(var i=e?this.inviewVideoIds.indexOf(e):-1,n=this.inviewVideoIds.concat(this.inviewVideoIds),o=i+1;o<=n.length;o++){var a=n[o];if(a&&this.allInstance[a]&&this.allInstance[a].canAutoPlay(this.focusedParentDom)&&(!he||this.canPlayQueue[a]))return a}return 0},Pe.addInviewKey=function(i){var n=this;if(!(-1<this.inviewVideoIds.indexOf(i)))if(he)this.inviewVideoIds.push(i);else{var e=this.inviewVideoIds.findIndex(
function(e){var t;return w(n.allInstance,n.allVideoInterViewRatio,i,e,null==(t=n.currentVideoInstance)?void 0:t.videoId)});-1===e?this.inviewVideoIds.push(i):this.inviewVideoIds.splice(e,0,i)}},Pe.setVideoInterViewRatio=function(e,t){this.allVideoInterViewRatio[e]=.99<t?1:+t.toFixed(2)},Pe.setInviewList=function(e){var l=this;e.forEach(function(e){var t=Number(e.target.getAttribute("data-video-id")),i=l.allInstance[t];if(l.setVideoInterViewRatio(t,e.intersectionRatio),i){var n,o,a,r,
s=i.options.intersectionOption.ratio;if(e.intersectionRatio>=s)(!i.startFindInstanceTime||i.startFindInstanceTime<0)&&(i.startFindInstanceTime=Date.now()),l.inviewVideoIds.indexOf(t)<=-1&&(i.emit("enterView"),l.addInviewKey(t),l.focusedParentDom&&!l.focusedParentDom.contains(i.options.container)&&l.clearPriority());else{if(i.startFindInstanceTime=-1,!P&&(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement))return
;-1<l.inviewVideoIds.indexOf(t)&&(i.emit("leaveView",i),i.destroy(!0),l.currentVideoInstance&&l.currentVideoInstance.videoId===t&&l.setCurrentVideoInstance(null),n=l.inviewVideoIds,o=t,-1<(a=n.findIndex(function(e){return e===o}))&&n.splice(a,1))}he&&l.formatOrder(null==(r=l.currentVideoInstance)?void 0:r.videoId)}})},Pe.updateCanPlayQueue=function(i){var n=this;if(i){var o=this.allInstance[i].options.container.getBoundingClientRect();this.inviewVideoIds.forEach(function(e){if(i!==e){
var t=n.allInstance[e].options.container.getBoundingClientRect();t.top!==o.top?n.canPlayQueue[e]=t.top>o.top?1:0:n.canPlayQueue[e]=t.left>o.left?1:0}else n.canPlayQueue[e]=1})}else this.inviewVideoIds.forEach(function(e){n.canPlayQueue[e]=1})},Pe.formatOrder=function(e){for(var t=this.inviewVideoIds.length,i=0;i<t-1;i++)for(var n=0;n<t-1-i;n++)if(!w(this.allInstance,this.allVideoInterViewRatio,this.inviewVideoIds[n],this.inviewVideoIds[n+1],e)){var o=[this.inviewVideoIds[n+1],
this.inviewVideoIds[n]];this.inviewVideoIds[n]=o[0],this.inviewVideoIds[n+1]=o[1]}this.updateCanPlayQueue(this.inviewVideoIds[0])},Pe.pageScrollStart=function(){this.beforeScrollVideoId=this.currentVideoInstance&&!this.currentVideoInstance.paused&&this.currentVideoInstance.videoId||0},Pe.pageScrollUp=function(){var o=this;if(1===this.allVideoInterViewRatio[this.beforeScrollVideoId]){var e=this.inviewVideoIds.findIndex(function(e){if(1!==o.allVideoInterViewRatio[e]||!o.allInstance[e].canAutoPlay(
))return!1;var t=o.allInstance[o.beforeScrollVideoId].options.container,i=o.allInstance[e].options.container,n=t.getBoundingClientRect();return 10<i.getBoundingClientRect().top-n.top});-1<e&&(this.updateCanPlayQueue(this.inviewVideoIds[e]),this.findNextPlayVideo())}},Pe.pageScrollDown=function(){this.formatOrder(),this.findNextPlayVideo()},new Ve);function Ve(){var e,t,i;u(this,"controllerEnable",!0),u(this,"allInstance",{}),u(this,"focusedParentDom",null),u(this,"isScroll",!1),u(this,
"nextPlayVideoId",0),u(this,"currentVideoInstance",null),u(this,"intersectObserver",this.createIntersectionObserver()),u(this,"inviewVideoIds",[]),u(this,"videoId",0),u(this,"isWasmPlayerSupport",r.support()),u(this,"allVideoInterViewRatio",{}),u(this,"beforeScrollVideoId",0),u(this,"canPlayQueue",{}),u(this,"hasScrolled",!1),u(this,"hasLeaved",!1),u(this,"hasLeaveState",!1),u(this,"events",new Map),u(this,"isFirstVideo",!0),u(this,"hasFsv",!1),u(this,"prerenderProcessed",!we),u(this,
"fpAutoPlayEl",null),u(this,"inForbidAutoplayTime",!1),u(this,"ttsForbidAutoplay",!1),u(this,"tryRecoverPreparePlayer",!1),u(this,"findNextPlayVideo",he?this.newFindNextVideo:function(n){var o=null,a=this,r=0;return function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];clearTimeout(o),0===r?(n.apply(a,t),r++):o=setTimeout(function(){n.apply(a,t),r++},100)}}(this.newFindNextVideo.bind(this))),this.controllerEnable=!(null!=(e=window.page)&&null!=(t=e.comm
)&&t.halfScreen),this.initFpAutoPlay(),ve&&h.default.isBaiduBox()&&((i=+E())&&h.default.isAndroid()?i<.5:i&&h.default.isIOS()&&i<.82)&&this.delayAutoplay(ve)}return ge});;
define("@baidu/video-controller",["require","@baidu/video-controller/lib/videoController"],function(e,o){return o});